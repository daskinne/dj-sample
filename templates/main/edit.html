{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="container">
	{% if user.is_authenticated %}
	<div class="row">
		<div class="col-lg-4">
			<h1>{{ deal.name }}
			<button class="pull-right btn btn-xs btn-primary" data-toggle="modal" data-target="#editdeal">
				Edit
			</button></h1>

			<p>
				{{ deal.description }}
			</p>
			<hr>
			<h3>Participants</h3>
			<h4>Buyers</h4>
			<ul>
				{% for buyer in buyers %}
				<li>
					{{ buyer.first_name }}
					{{ buyer.last_name }}
					({{ buyer.email }})
				</li>
				{% endfor %}
			</ul>
			<h4>Vendors</h4>
			<ul>
				{% for seller in sellers %}
				<li>
					{{ seller.first_name }}
					{{ seller.last_name }}
					({{ seller.email }})
				</li>
				{% endfor %}
			</ul>
			<hr>
			<h3>Invitations</h3>
			<div class="row">
				<div class="col-lg-8">
					<p>
						Collaborate with your coworkers and counterparty to get this deal done quickly and hassle-free!
					</p>
				</div>
				<div class="col-lg-4">
					<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
						Invite
					</button>
				</div>
			</div><h4>Waiting on...</h4>
			<ul>
				{% for user in pending_users %}
				<li>
					{{ user.email }}
				</li>
				{% endfor %}
			</ul>
			<hr>
			<h3>Documents </h3>
			{% for at in attachments %}
			<a href="{{ at.data }}">{{ at.data }}</a>
			{% endfor %}
			<form  enctype="multipart/form-data" class="horizontal-form" action="{{ attachment_form_target }}" method="post">
				{% csrf_token %}
				{{ attachment_form.as_p }}
				<input class="btn btn-primary" name="submit" type="submit" value="Attach File">
			</form>
		</div>
		<div class="col-lg-8">
			<div class="panel panel-default">
				<div class="panel-heading"><h2>Timeline</h2></div>
				<form class="horizontal-form" action="{{ message_form_target }}" class="input-group" method="post">
					<div class="panel-body">
						{% csrf_token %}
						{{ message_form.as_p }}
						<input class="btn btn-primary" name="submit" type="submit" value="Post Message">
					</div>
				</form>
			</div>
			<hr>
			{% for msg in messages %}
			<div class="comment" id="comment">
				<h5><strong>{{msg.user.email}}</strong><small>&nbsp;&nbsp;{{ msg.created_date|date:"j-M" }}</small></h5><p></p>
				<p>
					{{msg.message}}
				</p><p></p>
			</div>
			{% endfor %}
		</div>
	</div>
	<td>{{ deal.name }}</td>
	<td>{{ deal.description }}</td>
	<td>{{ deal.start_date|date:"j-M" }}</td>
	{% include "main/edit_deal_modal.html" %}
	{% include "main/add_user_modal.html" %}
	{% else %}
	Please Register
	{% endif %}
</div>
{% endblock %}